<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Milano Management System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header với tabs navigation -->
    <header class="header">
        <div class="logo">MILANO ☕</div>
        <div class="tabs">
            <button class="tab-btn active" data-tab="reports">
                <i class="fas fa-chart-line"></i>
                <span>Báo cáo</span>
            </button>
            <button class="tab-btn" data-tab="inventory">
                <i class="fas fa-boxes"></i>
                <span>Kho</span>
            </button>
            <button class="tab-btn" data-tab="employees">
                <i class="fas fa-users"></i>
                <span>Nhân viên</span>
            </button>
            <button class="tab-btn" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Tổng quan</span>
            </button>
            <button class="tab-btn" data-tab="settings">
                <i class="fas fa-cog"></i>
                <span>Cài đặt</span>
            </button>
        </div>
        <div class="sync-status" id="syncStatus">
            <i class="fas fa-sync-alt"></i>
            <span>Đồng bộ...</span>
        </div>
    </header>

    <!-- Main content container (sẽ được render bằng JS) -->
    <main class="main-content" id="mainContent">
        <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Đang tải dữ liệu...</p>
        </div>
    </main>

    <!-- Toast notification -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal container (dùng chung) -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="modal-container" id="modalContainer"></div>

    <!-- Import tất cả JS -->
    <script src="github.js"></script>
    <script src="data.js"></script>
    <script src="reports.js"></script>
    <script src="inventory.js"></script>
    <script src="employees.js"></script>
    <script src="dashboard.js"></script>
    <script src="settings.js"></script>
    
    <!-- Main app initialization -->
    <script>
        // Khởi tạo app khi DOM ready
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Milano System - Initializing...');
            
            // Kiểm tra GitHub token
            const token = localStorage.getItem('github_token');
            if (!token) {
                // Chuyển đến tab settings nếu chưa có token
                showTab('settings');
                showToast('Vui lòng nhập GitHub token để bắt đầu', 'warning');
            } else {
                // Load dữ liệu ban đầu
                await window.dataManager.init();
                showTab('reports');
            }
            
            // Xử lý click tab
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    showTab(tab);
                });
            });
            
            // Ẩn loading
            document.querySelector('.loading').style.display = 'none';
        });
        
        // Hàm hiển thị tab
        function showTab(tabName) {
            // Update active tab UI
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                }
            });
            
            // Render tab content
            const mainContent = document.getElementById('mainContent');
            
            switch(tabName) {
                case 'reports':
                    window.reportsModule.render();
                    break;
                case 'inventory':
                    window.inventoryModule.render();
                    break;
                case 'employees':
                    window.employeesModule.render();
                    break;
                case 'dashboard':
                    window.dashboardModule.render();
                    break;
                case 'settings':
                    window.settingsModule.render();
                    break;
                default:
                    mainContent.innerHTML = '<div class="error">Tab không tồn tại</div>';
            }
        }
        
        // Hàm hiển thị toast
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Hàm hiển thị modal
        function showModal(content, onClose = null) {
            const overlay = document.getElementById('modalOverlay');
            const container = document.getElementById('modalContainer');
            
            container.innerHTML = content;
            
            overlay.classList.add('active');
            container.classList.add('active');
            
            // Close modal khi click overlay
            overlay.onclick = () => closeModal();
            
            // Close modal với Escape key
            document.addEventListener('keydown', function escHandler(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    document.removeEventListener('keydown', escHandler);
                }
            });
            
            return {
                close: () => closeModal(onClose)
            };
        }
        
        function closeModal(callback = null) {
            const overlay = document.getElementById('modalOverlay');
            const container = document.getElementById('modalContainer');
            
            overlay.classList.remove('active');
            container.classList.remove('active');
            
            if (typeof callback === 'function') {
                callback();
            }
        }
        
        // Expose functions to window
        window.showToast = showToast;
        window.showModal = showModal;
        window.closeModal = closeModal;
        window.showTab = showTab;
    </script>
</body>
</html>